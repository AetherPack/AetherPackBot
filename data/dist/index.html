<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AetherPackBot</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .msg-row{margin-bottom:16px;display:flex;flex-direction:column}
        .msg-meta{font-size:12px;color:#94a3b8;margin-bottom:4px;display:flex;justify-content:space-between}
        .msg-bubble{padding:12px 16px;border-radius:12px;max-width:85%;line-height:1.5;word-wrap:break-word}
        .msg-user{align-items:flex-end}.msg-user .msg-bubble{background:#3b82f6;color:white;border-bottom-right-radius:2px}
        .msg-assistant{align-items:flex-start}.msg-assistant .msg-bubble{background:#f1f5f9;color:#1e293b;border-bottom-left-radius:2px}
        .stat-card{text-align:center;padding:20px}
        .stat-card .stat-value{font-size:2rem;font-weight:700;color:var(--primary)}
        .stat-card .stat-label{font-size:.85rem;color:#6b7280;margin-top:4px}
        .persona-card{border-left:4px solid var(--primary)}
        .persona-card.active{border-left-color:#10b981;background:#f0fdf4}
        .tab-bar{display:flex;gap:0;border-bottom:2px solid var(--border);margin-bottom:16px}
        .tab-bar button{padding:8px 20px;border:none;background:none;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px;color:#6b7280;font-size:14px}
        .tab-bar button.active{border-bottom-color:var(--primary);color:var(--primary);font-weight:600}
        .tab-bar button:hover{color:var(--primary)}
        .empty-state{text-align:center;padding:60px 20px;color:#9ca3af}
        .empty-state .icon{font-size:48px;margin-bottom:12px}
        .settings-panel.hidden{display:none}
    </style>
</head>
<body>
<div id="login-screen">
    <div class="card" style="width:380px;text-align:center;border:none;box-shadow:0 20px 25px -5px rgba(0,0,0,0.1);">
        <div style="font-size:48px;margin-bottom:10px;">ğŸ”·</div>
        <h2 class="mb-4">AetherPackBot</h2>
        <p class="text-gray mb-4">å¤šå¹³å° LLM æœºå™¨äººæ¡†æ¶</p>
        <div style="text-align:left;">
            <label>ç”¨æˆ·å</label>
            <input type="text" id="username" class="input" value="aetherpackbot">
            <label>å¯†ç </label>
            <input type="password" id="password" class="input" onkeydown="if(event.key==='Enter')app.login()">
        </div>
        <button onclick="app.login()" class="btn btn-primary" style="width:100%;justify-content:center;padding:10px;">ç™»å½•æ§åˆ¶å°</button>
        <p id="login-error" class="text-sm mt-4" style="color:var(--danger)"></p>
    </div>
</div>

<div id="app-layout" class="hidden" style="width:100%;display:flex;">
    <div class="sidebar">
        <div class="brand"><span>ğŸ”· AetherPackBot</span></div>
        <nav style="flex:1;">
            <a class="nav-item" onclick="app.nav('home')">ğŸ“Š ä»ªè¡¨ç›˜</a>
            <a class="nav-item" onclick="app.nav('platforms')">ğŸ“± æ¶ˆæ¯å¹³å°</a>
            <a class="nav-item" onclick="app.nav('providers')">âœ¨ æ¨¡å‹æä¾›å•†</a>
            <a class="nav-item" onclick="app.nav('persona')">â¤ï¸ äººæ ¼ç®¡ç†</a>
            <a class="nav-item" onclick="app.nav('plugins')">ğŸ§© æ‰©å±•æ’ä»¶</a>
            <a class="nav-item" onclick="app.nav('chat')">ğŸ’¬ åœ¨çº¿èŠå¤©</a>
            <a class="nav-item" onclick="app.nav('settings')">âš™ï¸ ç³»ç»Ÿè®¾ç½®</a>
            <a class="nav-item" onclick="app.nav('logs')">ğŸ“œ æ§åˆ¶å°æ—¥å¿—</a>
        </nav>
        <div style="padding:12px 16px;font-size:12px;color:#6b7280;" id="sidebar-version">v1.0.0</div>
        <a class="nav-item" onclick="app.logout()" style="color:var(--danger)">ğŸšª é€€å‡ºç™»å½•</a>
    </div>
    <main class="main">
        <!-- Dashboard -->
        <div id="view-home" class="view">
            <div class="flex items-center justify-between mb-4"><h1>ğŸ“Š ä»ªè¡¨ç›˜</h1><span class="badge badge-success">ç³»ç»Ÿæ­£å¸¸</span></div>
            <div class="grid" style="grid-template-columns:repeat(4,1fr);">
                <div class="card stat-card"><div class="stat-value" id="stat-platforms">-</div><div class="stat-label">æ¶ˆæ¯å¹³å°</div></div>
                <div class="card stat-card"><div class="stat-value" id="stat-providers">-</div><div class="stat-label">æ¨¡å‹æä¾›å•†</div></div>
                <div class="card stat-card"><div class="stat-value" id="stat-plugins">-</div><div class="stat-label">æ‰©å±•æ’ä»¶</div></div>
                <div class="card stat-card"><div class="stat-value" id="stat-uptime">-</div><div class="stat-label">è¿è¡Œæ—¶é—´</div></div>
            </div>
            <div class="grid mt-4" style="grid-template-columns:1fr 1fr;">
                <div class="card">
                    <h3>ğŸ’» ç³»ç»Ÿèµ„æº</h3>
                    <div class="mt-4">
                        <div class="flex justify-between text-sm mb-2"><span>CPU</span><span id="stat-cpu">-</span></div>
                        <div style="background:#e5e7eb;border-radius:4px;height:8px;overflow:hidden"><div id="stat-cpu-bar" style="background:var(--primary);height:100%;width:0%;transition:width .3s"></div></div>
                        <div class="flex justify-between text-sm mb-2 mt-4"><span>å†…å­˜</span><span id="stat-mem">-</span></div>
                    </div>
                </div>
                <div class="card">
                    <h3>ğŸš€ å¿«é€Ÿæ“ä½œ</h3>
                    <div class="mt-4 flex gap-2" style="flex-wrap:wrap">
                        <button onclick="app.nav('chat')" class="btn btn-primary">ğŸ’¬ èŠå¤©</button>
                        <button onclick="app.nav('providers')" class="btn btn-secondary">âœ¨ æ·»åŠ æ¨¡å‹</button>
                        <button onclick="app.nav('platforms')" class="btn btn-secondary">ğŸ“± æ·»åŠ å¹³å°</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Platforms -->
        <div id="view-platforms" class="view hidden">
            <div class="flex items-center justify-between mb-4"><h1>ğŸ“± æ¶ˆæ¯å¹³å°</h1><button onclick="app.modals.openPlatform()" class="btn btn-primary">+ æ·»åŠ å¹³å°</button></div>
            <div id="platforms-list" class="grid"></div>
        </div>

        <!-- Providers -->
        <div id="view-providers" class="view hidden">
            <div class="flex items-center justify-between mb-4"><h1>âœ¨ æ¨¡å‹æä¾›å•†</h1><button onclick="app.modals.openProvider()" class="btn btn-primary">+ æ·»åŠ æä¾›å•†</button></div>
            <div id="providers-list" class="grid"></div>
        </div>

        <!-- Persona -->
        <div id="view-persona" class="view hidden">
            <div class="flex items-center justify-between mb-4"><h1>â¤ï¸ äººæ ¼ç®¡ç†</h1><button onclick="app.modals.openPersona()" class="btn btn-primary">+ æ–°å»ºäººæ ¼</button></div>
            <div id="persona-list" class="grid" style="grid-template-columns:1fr;"></div>
        </div>

        <!-- Plugins -->
        <div id="view-plugins" class="view hidden">
            <div class="flex items-center justify-between mb-4"><h1>ğŸ§© æ‰©å±•æ’ä»¶</h1></div>
            <div id="plugins-list" class="grid"></div>
        </div>

        <!-- Chat -->
        <div id="view-chat" class="view hidden">
            <div class="flex items-center justify-between mb-4">
                <h1>ğŸ’¬ åœ¨çº¿èŠå¤©</h1>
                <div class="flex gap-2">
                    <select id="chat-provider-select" class="input" style="width:200px;margin-bottom:0"></select>
                    <button onclick="app.fetchChat()" class="btn btn-secondary">åˆ·æ–°</button>
                </div>
            </div>
            <div class="card" style="height:calc(100vh - 150px);display:flex;flex-direction:column;">
                <div id="chat-messages" style="flex:1;overflow-y:auto;padding-right:10px;margin-bottom:12px;"></div>
                <div style="border-top:1px solid var(--border);padding-top:12px;display:flex;gap:8px;">
                    <textarea id="chat-input" class="input" style="margin-bottom:0;resize:none;height:50px;" placeholder="è¾“å…¥æ¶ˆæ¯... (Ctrl+Enter å‘é€)" onkeydown="if(event.ctrlKey&&event.key==='Enter')app.sendChat()"></textarea>
                    <button class="btn btn-primary" onclick="app.sendChat()" style="height:50px;">å‘é€</button>
                </div>
            </div>
        </div>

        <!-- Settings -->
        <div id="view-settings" class="view hidden">
            <h1>âš™ï¸ ç³»ç»Ÿè®¾ç½®</h1>
            <div class="tab-bar">
                <button class="active" onclick="app.settingsTab('general',this)">åŸºæœ¬è®¾ç½®</button>
                <button onclick="app.settingsTab('web',this)">Web æœåŠ¡</button>
                <button onclick="app.settingsTab('reply',this)">å›å¤è®¾ç½®</button>
                <button onclick="app.settingsTab('account',this)">è´¦å·ç®¡ç†</button>
            </div>
            <div id="settings-general" class="settings-panel">
                <div class="card"><h3>ğŸ¤– åŸºæœ¬é…ç½®</h3>
                    <form onsubmit="event.preventDefault();app.actions.saveSettings()">
                        <label>æœºå™¨äººæ˜µç§°</label><input id="conf-agent-name" class="input" placeholder="AetherPackBot">
                        <label>å”¤é†’å‰ç¼€ (é€—å·åˆ†éš”)</label><input id="conf-wake-prefixes" class="input" placeholder="/, !">
                        <label>é»˜è®¤æä¾›å•† ID</label><input id="conf-default-provider" class="input" placeholder="openai_0">
                        <div class="flex justify-end mt-4"><button type="submit" class="btn btn-primary">ä¿å­˜</button></div>
                    </form>
                </div>
            </div>
            <div id="settings-web" class="settings-panel hidden">
                <div class="card"><h3>ğŸŒ Web æœåŠ¡</h3>
                    <form onsubmit="event.preventDefault();app.actions.saveWebSettings()">
                        <label>ç›‘å¬åœ°å€</label><input id="conf-web-host" class="input" value="0.0.0.0">
                        <label>ç«¯å£</label><input id="conf-web-port" class="input" type="number" value="6185">
                        <div class="flex justify-end mt-4"><button type="submit" class="btn btn-primary">ä¿å­˜ (é‡å¯ç”Ÿæ•ˆ)</button></div>
                    </form>
                </div>
            </div>
            <div id="settings-reply" class="settings-panel hidden">
                <div class="card"><h3>ğŸ’¬ å›å¤è¡Œä¸º</h3>
                    <form onsubmit="event.preventDefault();app.actions.saveReplySettings()">
                        <label class="flex items-center gap-2"><input type="checkbox" id="conf-reply-at"> å›å¤æ—¶ @å‘é€è€…</label>
                        <label class="flex items-center gap-2 mt-2"><input type="checkbox" id="conf-reply-quote"> å¼•ç”¨åŸæ¶ˆæ¯</label>
                        <label class="flex items-center gap-2 mt-2"><input type="checkbox" id="conf-reply-prefix"> æ·»åŠ å‰ç¼€</label>
                        <label class="mt-2">å‰ç¼€æ¨¡æ¿</label><input id="conf-reply-prefix-tpl" class="input" placeholder="{bot_name}: ">
                        <div class="flex justify-end mt-4"><button type="submit" class="btn btn-primary">ä¿å­˜</button></div>
                    </form>
                </div>
            </div>
            <div id="settings-account" class="settings-panel hidden">
                <div class="card"><h3>ğŸ”‘ ä¿®æ”¹ç®¡ç†å‘˜å¯†ç </h3>
                    <form onsubmit="event.preventDefault();app.actions.changePassword()">
                        <label>æ–°ç”¨æˆ·å</label><input id="conf-new-username" class="input" placeholder="ç•™ç©ºä¸ä¿®æ”¹">
                        <label>æ–°å¯†ç </label><input id="conf-new-password" type="password" class="input">
                        <label>ç¡®è®¤æ–°å¯†ç </label><input id="conf-new-password2" type="password" class="input">
                        <div class="flex justify-end mt-4"><button type="submit" class="btn btn-primary">ä¿®æ”¹</button></div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div id="view-logs" class="view hidden">
            <div class="flex items-center justify-between mb-4">
                <h1>ğŸ“œ æ§åˆ¶å°æ—¥å¿—</h1>
                <div class="flex gap-2">
                    <label class="flex items-center gap-2 text-sm"><input type="checkbox" id="auto-scroll-logs" checked> è‡ªåŠ¨æ»šåŠ¨</label>
                    <button onclick="app.fetchLogs()" class="btn btn-secondary">åˆ·æ–°</button>
                </div>
            </div>
            <div id="logs-container" class="card" style="background:#1e1e1e;color:#d4d4d4;font-family:'Consolas',monospace;height:calc(100vh - 150px);overflow-y:auto;padding:15px;font-size:13px;white-space:pre-wrap;"></div>
        </div>
    </main>
</div>

<div id="notify-area"></div>

<!-- Provider Modal -->
<div id="modal-provider" class="modal-overlay"><div class="modal">
    <div class="flex justify-between items-center mb-4"><h2 id="modal-provider-title">æ·»åŠ æä¾›å•†</h2><button onclick="app.modals.close()" class="btn-ghost">âœ•</button></div>
    <form onsubmit="event.preventDefault();app.actions.saveProvider()">
        <label>æä¾›å•†ç±»å‹</label>
        <select id="prov-type" class="input" onchange="app.render.onProvTypeChange()">
            <option value="openai">OpenAI</option><option value="anthropic">Anthropic Claude</option>
            <option value="deepseek">DeepSeek</option><option value="gemini">Google Gemini</option>
            <option value="ollama">Ollama (æœ¬åœ°)</option><option value="groq">Groq</option>
            <option value="moonshot">Moonshot (Kimi)</option><option value="siliconflow">ç¡…åŸºæµåŠ¨</option>
            <option value="zhipu">æ™ºè°± AI</option><option value="mistral">Mistral AI</option>
            <option value="xai">xAI (Grok)</option><option value="lm_studio">LM Studio</option>
            <option value="openai_compatible">OpenAI å…¼å®¹æ¥å£</option>
        </select>
        <label>æ˜¾ç¤ºåç§°</label><input id="prov-name" class="input" placeholder="ä¾‹å¦‚ï¼šGPT-4o ä¸»åŠ›">
        <div id="field-prov-key"><label>API Key</label><input id="prov-key" type="password" class="input" placeholder="sk-..."></div>
        <label>API åŸºç¡€ URL <span class="text-sm text-gray">(å¯é€‰)</span></label><input id="prov-base-url" class="input" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤">
        <label>æ¨¡å‹</label><input id="prov-model" class="input" placeholder="è‡ªåŠ¨å¡«å……é»˜è®¤æ¨¡å‹">
        <p id="prov-models-hint" class="text-sm text-gray mt-1"></p>
        <div class="flex justify-end gap-2 mt-4"><button type="button" onclick="app.modals.close()" class="btn btn-secondary">å–æ¶ˆ</button><button type="submit" class="btn btn-primary">ä¿å­˜</button></div>
    </form>
</div></div>

<!-- Platform Modal -->
<div id="modal-platform" class="modal-overlay"><div class="modal">
    <div class="flex justify-between items-center mb-4"><h2 id="modal-platform-title">æ·»åŠ å¹³å°</h2><button onclick="app.modals.close()" class="btn-ghost">âœ•</button></div>
    <form onsubmit="event.preventDefault();app.actions.savePlatform()">
        <label>å¹³å°ç±»å‹</label>
        <select id="plat-type" class="input" onchange="app.render.onPlatTypeChange()">
            <option value="telegram">Telegram</option><option value="discord">Discord</option>
            <option value="qq_onebot">QQ (OneBot v11)</option>
            <option value="slack">Slack</option><option value="dingtalk">é’‰é’‰ (DingTalk)</option>
            <option value="lark">é£ä¹¦ (Lark)</option>
        </select>
        <label>é…ç½®åç§° / ID</label><input id="plat-name" class="input" placeholder="ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ">
        <div id="field-plat-token"><label>Token / å‡­è¯</label><input id="plat-token" class="input" placeholder="Bot Token"></div>
        <div id="field-plat-url"><label>API åœ°å€ (å¯é€‰)</label><input id="plat-url" class="input" placeholder="ws://..."></div>
        <div id="field-onebot-opts" class="hidden mb-4 p-4 rounded" style="background:#f8fafc;border:1px solid #e2e8f0;">
            <h4 class="mb-2">OneBot åå‘ WS é…ç½®</h4>
            <label>åå‘ Websocket ä¸»æœº</label><input id="plat-ws-host" class="input" value="0.0.0.0" placeholder="0.0.0.0">
            <p class="text-xs text-gray mb-2">AetherPackBot å°†ä½œä¸ºæœåŠ¡å™¨ç«¯ã€‚</p>
            <label>åå‘ Websocket ç«¯å£</label><input id="plat-ws-port" class="input" type="number" value="8081" placeholder="8081">
            <label>åå‘ Websocket Token</label><input id="plat-ws-token" class="input" placeholder="æœªè®¾ç½®åˆ™ä¸å¯ç”¨ Token éªŒè¯">
            <p class="text-xs text-gray mt-1">NAPCat / LLOneBot / Lagrange åå‘ WS è¿è‡³: ws://æ­¤IP:æ­¤ç«¯å£/ws</p>
        </div>
        <div class="flex justify-end gap-2 mt-4"><button type="button" onclick="app.modals.close()" class="btn btn-secondary">å–æ¶ˆ</button><button type="submit" class="btn btn-primary">ä¿å­˜</button></div>
    </form>
</div></div>

<!-- Persona Modal -->
<div id="modal-persona" class="modal-overlay"><div class="modal">
    <div class="flex justify-between items-center mb-4"><h2 id="modal-persona-title">æ–°å»ºäººæ ¼</h2><button onclick="app.modals.close()" class="btn-ghost">âœ•</button></div>
    <form onsubmit="event.preventDefault();app.actions.savePersona()">
        <label>äººæ ¼åç§°</label><input id="persona-name" class="input" placeholder="ä¾‹å¦‚ï¼šçŒ«å¨˜ã€åŠ©æ‰‹">
        <label>æè¿°</label><input id="persona-desc" class="input" placeholder="ç®€çŸ­æè¿°">
        <label>ç³»ç»Ÿæç¤ºè¯ (System Prompt)</label>
        <textarea id="persona-prompt" class="input" style="height:200px;font-family:monospace;" placeholder="You are a helpful assistant..."></textarea>
        <div class="flex justify-end gap-2 mt-4"><button type="button" onclick="app.modals.close()" class="btn btn-secondary">å–æ¶ˆ</button><button type="submit" class="btn btn-primary">ä¿å­˜</button></div>
    </form>
</div></div>

<script src="js/app.js"></script>
</body>
</html>
